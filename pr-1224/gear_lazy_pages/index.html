<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Lazy pages support. In runtime data for contract wasm memory pages can be loaded in lazy manner. All pages, which is supposed to be lazy, must be mprotected before contract execution. During execution data from storage is loaded for all pages, which has been accesed. See also `sys::user_signal_handler` in the source code."><meta name="keywords" content="rust, rustlang, rust-lang, gear_lazy_pages"><title>gear_lazy_pages - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script defer src="../crates.js"></script><script defer src="../main.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../gear_lazy_pages/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../gear_lazy_pages/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Crate gear_lazy_pages</a></h2><div class="sidebar-elems"><div class="block"><ul><li class="version">Version 0.1.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul></div><section><div class="block"><ul><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../gear_lazy_pages/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1">
                                <a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div>
                        </div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">gear_lazy_pages</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/gear_lazy_pages/lib.rs.html#19-240">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Lazy pages support.
In runtime data for contract wasm memory pages can be loaded in lazy manner.
All pages, which is supposed to be lazy, must be mprotected before contract execution.
During execution data from storage is loaded for all pages, which has been accesed.
See also <code>sys::user_signal_handler</code> in the source code.</p>
<p>Restrict any page handling in signal handler more then one time.
If some page will be released twice it means, that this page has been added
to lazy pages more then one time during current execution.
This situation may cause problems with memory data update in storage.
For example: one page has no data in storage, but allocated for current program.
Let’s make some action for it:</p>
<ol>
<li>Change data in page: Default data  -&gt;  Data1</li>
<li>Free page</li>
<li>Alloc page, data will Data2 (may be equal Data1).</li>
<li>After alloc we can set page as lazy, to identify wether page is changed after allocation.
This means that we can skip page update in storage in case it wasnt changed after allocation.</li>
<li>Write some data in page but do not change it Data2 -&gt; Data2.
During this step signal handler writes Data2 as data for released page.</li>
<li>After execution we will have Data2 in page. And Data2 in released. So, nothing will be updated
in storage. But program may have some significant data for next execution - so we have a bug.
To avoid this we restrict double releasing.
You can also check another cases in test: memory_access_cases.</li>
</ol>
</div></details><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Error.html" title="gear_lazy_pages::Error enum">Error</a></div><div class="item-right docblock-short"></div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.append_lazy_pages_info.html" title="gear_lazy_pages::append_lazy_pages_info fn">append_lazy_pages_info</a><span class="stab deprecated" title="">Deprecated</span></div><div class="item-right docblock-short"><p>Set lazy pages info and program <code>pages</code> <code>prefix</code> in global context</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_lazy_pages_numbers.html" title="gear_lazy_pages::get_lazy_pages_numbers fn">get_lazy_pages_numbers</a><span class="stab deprecated" title="">Deprecated</span></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_released_page_data.html" title="gear_lazy_pages::get_released_page_data fn">get_released_page_data</a></div><div class="item-right docblock-short"><p>Returns data for released <code>page</code></p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_released_pages.html" title="gear_lazy_pages::get_released_pages fn">get_released_pages</a></div><div class="item-right docblock-short"><p>Returns vec of lazy pages which has been accessed</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_wasm_mem_addr.html" title="gear_lazy_pages::get_wasm_mem_addr fn">get_wasm_mem_addr</a></div><div class="item-right docblock-short"><p>Returns current wasm mem buffer pointer, if it’s set</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_wasm_mem_size.html" title="gear_lazy_pages::get_wasm_mem_size fn">get_wasm_mem_size</a></div><div class="item-right docblock-short"><p>Returns current wasm mem buffer size, if it’s set</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.init.html" title="gear_lazy_pages::init fn">init</a><a title="unsafe function" href="#"><sup>⚠</sup></a></div><div class="item-right docblock-short"><p>Initialize lazy pages:</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.is_enabled.html" title="gear_lazy_pages::is_enabled fn">is_enabled</a></div><div class="item-right docblock-short"><p>Returns whether lazy pages env is enabled</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.reset_context.html" title="gear_lazy_pages::reset_context fn">reset_context</a></div><div class="item-right docblock-short"><p>Reset lazy pages info</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.set_lazy_page_info.html" title="gear_lazy_pages::set_lazy_page_info fn">set_lazy_page_info</a><span class="stab deprecated" title="">Deprecated</span></div><div class="item-right docblock-short"><p>Set storage <code>key</code> for <code>page</code> in global context</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.set_program_prefix.html" title="gear_lazy_pages::set_program_prefix fn">set_program_prefix</a></div><div class="item-right docblock-short"><p>Set program pages <code>prefix</code> in storage in global context</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.set_wasm_mem_begin_addr.html" title="gear_lazy_pages::set_wasm_mem_begin_addr fn">set_wasm_mem_begin_addr</a></div><div class="item-right docblock-short"><p>Set current wasm memory begin addr in global context</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.set_wasm_mem_size.html" title="gear_lazy_pages::set_wasm_mem_size fn">set_wasm_mem_size</a></div><div class="item-right docblock-short"><p>Set current wasm memory size in global context</p>
</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="gear_lazy_pages" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.64.0-nightly (848090dcd 2022-07-22)" ></div>
</body></html>